# 軽貨物ドライバー給料明細管理システム V2.2

## 📝 概要

軽貨物ドライバーの給料明細作成を効率化するWebシステムです。ドライバーごとに異なる単価、リース条件、控除項目に対応し、複雑な給料計算を自動化します。

## ✨ 主要機能

### 1. ドライバー管理
- 基本情報（氏名、電話番号、メールアドレス）
- 銀行口座情報（銀行名、支店名、口座種別、口座番号、口座名義）
- リース契約情報（月額保険料、月額車両リース代、車両ナンバー）
- 備考欄

### 2. 配送タイプ管理
- 配送タイプ名と単価の設定
- ドライバーごとに異なる配送タイプ・単価を設定可能

### 3. 給料明細作成
- **基本情報入力**: 会社名、担当センター、年月、集計期間
- **作業明細入力**: 配送タイプごとの個数入力（単価は自動表示）
- **消費税自動計算**: 内消費税（10%対象）を自動計算
- **控除情報入力**: 振込手数料、保険料、車両リース代、前借り、その他控除
- **自動計算**: 差引支給額を自動計算
- **備考欄**: 自由記述欄

### 4. 明細一覧・管理
- **フィルタリング**: ドライバー、年、月でフィルタリング
- **一覧表示**: カード形式で明細を表示
- **詳細表示**: モーダルで詳細を表示
- **印刷機能**: 印刷用レイアウトで明細書を印刷
- **削除機能**: 明細の削除

## 🚀 使用方法

### 初回セットアップ

1. **配送タイプの登録**
   - 「配送タイプ管理」タブをクリック
   - 「新規配送タイプ登録」ボタンをクリック
   - 配送タイプ名（例: ヤマト宅急便）と単価（例: 180円/個）を入力
   - 保存

2. **ドライバーの登録**
   - 「ドライバー管理」タブをクリック
   - 「新規ドライバー登録」ボタンをクリック
   - 基本情報を入力
   - 銀行口座情報を入力
   - リース契約がある場合は「リース契約あり」にチェックし、詳細を入力
   - 保存

### 給料明細の作成

1. **給料明細作成タブに移動**
   - 「給料明細作成」タブをクリック

2. **ドライバー選択**
   - ドライバーを選択（リース情報が自動入力されます）
   - 配送タイプ・単価が自動表示されます

3. **基本情報入力**
   - 会社名、担当センターを入力
   - 年月を選択
   - 集計期間（開始日〜終了日）を入力

4. **作業明細入力**
   - 各配送タイプの個数を入力
   - 小計が自動計算されます
   - 必要に応じて「作業明細を追加」ボタンで行を追加

5. **控除情報入力**
   - 振込手数料、前借り、その他控除を入力
   - 保険料、車両リース代はドライバー情報から自動入力されます（読取専用）

6. **計算**
   - 「計算」ボタンをクリックして計算結果を確認

7. **保存**
   - 「保存」ボタンをクリックして明細を保存

### 明細の確認・印刷

1. **明細一覧タブに移動**
   - 「明細一覧」タブをクリック

2. **フィルタリング（任意）**
   - ドライバー、年、月でフィルタリング可能

3. **詳細表示**
   - 明細カードをクリックして詳細を表示

4. **印刷**
   - 「印刷」ボタンをクリックして印刷ダイアログを表示
   - ※金額が0円の控除項目は自動的に非表示になります

5. **削除**
   - 「削除」ボタンをクリックして明細を削除

## 📊 計算ロジック

### 作業明細計算
```
小計 = 個数 × 単価
作業小計（税抜） = Σ(各配送タイプの小計)
内消費税（10%対象） = 作業小計 × 10 / 110（四捨五入）
作業合計（税込） = 作業小計
```

### 控除計算
```
控除合計 = 振込手数料 + 保険料 + 車両リース代 + 前借り + その他控除
差引支給額 = 作業合計（税込） - 控除合計
```

## 🗂️ データベース構造

### drivers_v3 テーブル
ドライバーの基本情報、銀行口座情報、リース契約情報を管理

### delivery_types テーブル
配送タイプ名と単価を管理

### payslips_v4 テーブル
給料明細の全データを管理（作業明細はJSON配列として保存）

## 🎨 技術スタック

- **HTML5**: セマンティックマークアップ
- **CSS3**: レスポンシブデザイン、印刷用スタイル
- **Vanilla JavaScript**: DOM操作、イベント処理、CRUD操作
- **Font Awesome 6.4.0**: アイコン
- **Google Fonts (Noto Sans JP)**: 日本語フォント
- **RESTful Table API**: データ永続化

## 📱 レスポンシブ対応

- デスクトップ（1400px以上）
- タブレット（768px〜1399px）
- モバイル（767px以下）

## 🖨️ 印刷機能

印刷時には以下のような専用レイアウトで表示されます:

```
給 料 明 細 書

御中: [ドライバー名] 様
支払合計金額: ¥XXX,XXX

[会社名]
[担当センター]

[YYYY年MM月]
集計期間: YYYY/MM/DD 〜 YYYY/MM/DD

作業明細
┌─────────────┬────┬──────┬──────────┐
│ 配送タイプ   │個数│単価  │ 金額     │
├─────────────┼────┼──────┼──────────┤
│ヤマト宅急便  │1532│¥180  │¥275,760  │
│ヤマトネコポス│ 797│¥80   │¥63,760   │
└─────────────┴────┴──────┴──────────┘

内消費税(10%対象): ¥30,880
作業合計(税込10%対象): ¥339,680

控除明細
┌────────────────┬──────────┐
│ 項目           │ 金額     │
├────────────────┼──────────┤
│ 振込手数料     │ ¥495     │
│ 保険料         │ ¥5,000   │
│ 車両リース代   │ ¥45,000  │
│ 前借り         │ ¥30,000  │
│ 燃料費         │ ¥20,000  │
└────────────────┴──────────┘

控除合計: ¥100,495
差引合計金額: ¥239,185

備考:
[備考内容を表示]
```

**注意**: 金額が0円の控除項目は印刷時に非表示になります。

## 📋 使用例

### ケーススタディ: 實方 徹さんの給料明細作成

#### ドライバー登録
```
氏名: 實方 徹
電話番号: 090-1234-5678
メールアドレス: sanegata@example.com
銀行名: 三菱UFJ銀行
支店名: 新宿支店
口座種別: 普通
口座番号: 1234567
口座名義: サネガタ トオル
リース契約: あり
月額保険料: 5,000円
月額車両リース代: 45,000円
車両ナンバー: 品川 500 あ 12-34
```

#### 配送タイプ登録
```
1. ヤマト宅急便: 180円/個
2. ヤマトネコポス: 80円/個
3. ネコポス持ち帰り: 80円/個
```

#### 給料明細作成
```
会社名: ○○運送株式会社
担当センター: 新宿センター
年月: 2025年11月
集計期間: 2025/11/01 〜 2025/11/30

【作業明細】
ヤマト宅急便: 1,532個 × 180円 = 275,760円
ヤマトネコポス: 797個 × 80円 = 63,760円
ネコポス持ち帰り: 2個 × 80円 = 160円

内消費税(10%対象): 30,880円
作業合計(税込10%対象): 339,680円

【控除明細】
振込手数料: 495円
保険料: 5,000円（自動）
車両リース代: 45,000円（自動）
前借り: 30,000円
その他控除名: 燃料費
その他控除: 20,000円

控除合計: 100,495円
差引支給額: 239,185円
```

## 🔧 トラブルシューティング

### Q: ドライバー選択時に配送タイプが表示されない
**A**: 配送タイプ管理タブで事前に配送タイプを登録してください

### Q: 計算結果が正しくない
**A**: 各入力値を確認し、「計算」ボタンを再度クリックしてください

### Q: 印刷時にレイアウトが崩れる
**A**: ブラウザの印刷設定で「背景のグラフィック」をオンにしてください

### Q: リース情報が自動入力されない
**A**: ドライバー登録時に「リース契約あり」にチェックし、金額を入力してください

## 📄 ファイル構成

```
/home/user/webapp/
├── index_v2.html              # メインHTMLファイル
├── css/
│   └── style_v2.css           # スタイルシート
├── js/
│   └── app_v2.js              # JavaScriptアプリケーション
├── schema_drivers_v3.json     # ドライバーテーブルスキーマ
├── schema_delivery_types.json # 配送タイプテーブルスキーマ
├── schema_payslips_v4.json    # 給料明細テーブルスキーマ
└── README_V2.2.md             # このファイル
```

## 🎯 今後の拡張機能（バックエンド実装時）

### 自動メール送信機能
- 給料明細保存時にPDFを自動生成
- ドライバーのメールアドレスへ自動送信
- 送信履歴の記録

### ドライバー認証システム
- ドライバー専用ログイン
- 自分の明細のみ閲覧可能
- 変更依頼フォーム

### 業務データリアルタイム収集
- スマホアプリで業務報告
- リアルタイムでデータベースに蓄積
- 月末に自動集計
- 明細自動生成

### サーバーサイドPDF生成
- ヘッドレスブラウザでPDF生成
- クラウドストレージに保存
- ダウンロードリンク生成

## ⚠️ 注意事項

### 現在の制約
1. **静的Webサイト**: バックエンド機能なし
2. **手動メール送信**: 印刷→PDF保存→手動添付が必要
3. **ドライバー認証なし**: 全データが閲覧可能
4. **手動データ入力**: 業務データの自動収集なし

### セキュリティ
- 本番環境では適切な認証・認可機能が必要
- 個人情報の暗号化推奨
- HTTPS通信必須

### パフォーマンス
- 大量データ（1000件以上）の場合はページネーション推奨
- 画像・PDFは外部ストレージ利用推奨

## 📞 サポート

システムに関するご質問やバグ報告は、プロジェクト管理者までお問い合わせください。

## 📜 バージョン履歴

### V2.2（現行版）
- 前借り控除項目を追加
- その他控除名・金額のカスタマイズ機能追加
- 印刷時の0円項目非表示機能追加
- UI/UXの改善

### V2.1
- リース契約情報の分離（保険料・車両リース代）
- 銀行口座情報の追加
- 配送タイプ管理機能の追加

### V2.0
- 完全リニューアル
- RESTful Table APIへの移行
- レスポンシブデザインの実装

---

**開発:** 軽貨物ドライバー給料明細管理システム開発チーム  
**最終更新:** 2025年12月28日
